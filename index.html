<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlyStay Malpensa - Il tuo soggiorno vicino all'Aeroporto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the map icon and general overrides */
        .map-icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
            margin-right: 8px;
        }

        /* NEW: Badge Styliing for Featured Apartments */
        .premium-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: #FFD700; /* Gold color for the medal */
            color: #333;
            font-weight: bold;
            padding: 6px 10px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 10;
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        .medal-icon {
            width: 18px;
            height: 18px;
            fill: #333;
            margin-right: 6px;
        }
        
        /* Modal gallery simple styling for demo */
        #modal-image-gallery img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        /* New: Styling for the Contact Info box */
        .contact-info-box {
            transition: max-height 0.5s ease-in-out, opacity 0.4s ease-in-out;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            padding: 0 1rem; /* Initial zero padding horizontal only */
            margin: 0; /* Initial zero margin */
        }
        .contact-info-box.active {
            max-height: 200px; /* Sufficient height to show content */
            opacity: 1;
            padding-top: 1rem; 
            padding-bottom: 1rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 relative">

    <header class="sticky top-0 z-50 bg-white shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-sky-600">FlyStay Malpensa</div>
            <div class="flex items-center space-x-4">
                <a href="#apartments-section" class="text-gray-600 hover:text-sky-600 font-medium transition duration-300" data-translate="nav_apartments">Appartamenti</a>
                <a href="#about-section" class="text-gray-600 hover:text-sky-600 font-medium transition duration-300" data-translate="nav_about">Chi Siamo</a>
                <a href="#contact-section" class="text-gray-600 hover:text-sky-600 font-medium transition duration-300" data-translate="nav_contact">Contatti</a>
                
                <div class="flex space-x-2 ml-4">
                    <button id="lang-it" class="lang-button bg-sky-500 hover:bg-sky-600 text-white text-xs font-bold py-1 px-2 rounded transition duration-300">IT</button>
                    <button id="lang-en" class="lang-button bg-gray-600 hover:bg-gray-700 text-white text-xs font-bold py-1 px-2 rounded transition duration-300">EN</button>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="relative bg-gray-900 h-[60vh] flex items-center justify-center text-center overflow-hidden">
            <img src="https://i.ibb.co/mrKPxj0M/Gemini-Generated-Image-vumthkvumthkvumt.png" 
                 alt="Modern apartment interior" 
                 class="absolute inset-0 w-full h-full object-cover opacity-60">
            <div class="relative z-10 p-6">
                <h1 class="text-5xl md:text-7xl font-extrabold text-white mb-4 drop-shadow-lg" data-translate="hero_title">FlyStay Malpensa</h1>
                <p class="text-xl md:text-2xl text-gray-200 mb-8 drop-shadow-md" data-translate="hero_subtitle">Il tuo soggiorno perfetto vicino all'aeroporto di Malpensa.</p>
                <a href="#apartments-section" class="inline-block bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105" data-translate="explore_button">Esplora Appartamenti</a>
            </div>
        </section>
        
        <section id="about-section" class="py-16 bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-center text-slate-800 mb-8" data-translate="about_title">Chi Siamo</h2>
        <div class="max-w-4xl mx-auto text-lg text-gray-600 space-y-4">
            <p data-translate="about_paragraph_1">Benvenuti su FlyStay Malpensa, la vostra soluzione ideale per un soggiorno confortevole e conveniente vicino all'aeroporto di Malpensa. Comprendiamo l'importanza di un riposo sereno prima o dopo un lungo viaggio, ed è per questo che ci impegniamo a offrire appartamenti accoglienti e ben attrezzati, pensati per soddisfare ogni vostra esigenza.</p>
            <p data-translate="about_paragraph_2">La nostra missione è semplice: garantire un'esperienza senza stress, offrendo alloggi di qualità superiore con tutti i comfort moderni, in posizioni strategiche che permettono un facile accesso all'aeroporto e alle principali attrazioni della zona.</p>
            <p data-translate="about_paragraph_3">Siamo qui per rendere il vostro viaggio il più piacevole possibile. Scegliete FlyStay Malpensa per un soggiorno indimenticabile!</p>
        </div>
    </div>
</section>
        
        <section id="featured-apartments-section" class="py-16 bg-white">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl font-bold text-center text-slate-800 mb-2" data-translate="featured_title">✨ Soluzioni in Evidenza ✨</h2>
                <p class="text-center text-gray-500 mb-10" data-translate="featured_subtitle">Gli appartamenti PREMIUM sono la soluzione consigliada da noi di FlyStayMalpensa.</p>
                
                <div id="loading-indicator" class="text-center text-sky-600 font-semibold hidden" data-translate="loading_apartments">Caricamento appartamenti...</div>
                <p id="no-featured-message" class="text-center text-gray-500 italic hidden mt-8" data-translate="no_featured_found">Nessun appartamento in evidenza al momento.</p>

                <div id="featured-apartments-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    </div>
            </div>
        </section>

        <section id="apartments-section" class="py-16 bg-gray-50">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl font-bold text-center text-slate-800 mb-10" data-translate="apartments_available">Tutte le Soluzioni Disponibili</h2>
                
                <p id="no-apartments-message" class="text-center text-gray-500 italic hidden mt-8" data-translate="no_apartments_found">Nessun altro appartamento trovato.</p>

                <div id="apartments-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    </div>
            </div>
        </section>
        
        <section id="reviews-section" class="py-16 bg-sky-50">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl font-bold text-center text-slate-800 mb-10" data-translate="reviews_title">Dicono di Noi</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-sky-500">
                        <p class="text-gray-600 italic mb-4" data-translate="review_text_1">Soggiorno fantastico! L'appartamento era pulitissimo e molto confortevole. Perfetto per chi ha bisogno di un punto d'appoggio vicino Malpensa.</p>
                        <p class="font-semibold text-slate-700" data-translate="review_user_1_name">Marco Rossi</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-sky-500">
                        <p class="text-gray-600 italic mb-4" data-translate="review_text_2">Ottima posizione e personale molto disponibile. Ho apprezzato la tranquillità e la comodità. Tornerò sicuramente!</p>
                        <p class="font-semibold text-slate-700" data-translate="review_user_2_name">Laura Bianchi</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-sky-500">
                        <p class="text-gray-600 italic mb-4" data-translate="review_text_3">Impeccable apartment and seamless check-in process. Highly recommend for anyone needing accommodation near Malpensa Airport.</p>
                        <p class="font-semibold text-slate-700" data-translate="review_user_3_name">John Doe</p>
                    </div>
                </div>
                <div class="text-center mt-10">
                    <a href="#" class="text-sky-600 hover:text-sky-800 font-semibold transition duration-300" data-translate="view_all_reviews">Leggi tutte le recensioni</a>
                </div>
            </div>
        </section>

        <section id="contact-section" class="py-16 bg-white">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl font-bold text-slate-800 mb-4" data-translate="contact_title">Contatti Generali</h2>
                <p class="text-lg text-gray-600 mb-8" data-translate="contact_text">Hai domande o hai bisogno di assistenza generale? Non esitare a contattarci!</p>
                <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-8">
                    <div class="flex items-center text-xl text-slate-700">
                        <span class="font-semibold mr-2" data-translate="contact_email">Email:</span>
                        <a href="mailto:info@flystaymalpensa.com" class="text-sky-600 hover:text-sky-800 font-medium">info@flystaymalpensa.com</a>
                    </div>
                    <div class="flex items-center text-xl text-slate-700">
                        <span class="font-semibold mr-2" data-translate="contact_phone">Telefono:</span>
                        <a href="tel:+3903311234567" class="text-sky-600 hover:text-sky-800 font-medium">+39 0331 1234567</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="mb-4">© 2024 FlyStay Malpensa. <span data-translate="footer_rights">Tutti i diritti riservati.</span></p>
            <div class="space-x-4">
                <span class="text-gray-400" data-translate="footer_info">Per informazioni:</span>
                <a href="#" class="text-sky-400 hover:text-sky-200 transition duration-300" onclick="showDisclaimer(event)" data-translate="footer_disclaimer">Disclaimer</a>
            </div>
        </div>
    </footer>

    <button id="scrollToTopBtn" class="fixed bottom-6 right-6 bg-sky-500 text-white p-3 rounded-full shadow-xl transition-all duration-300 transform opacity-0 translate-y-4 pointer-events-none hover:bg-sky-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>
    
    <div id="apartment-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-75 flex items-center justify-center hidden transition-opacity duration-300" onclick="if(event.target === this) closeApartmentModal()">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4 transform transition-all duration-300 scale-95 opacity-0" 
             style="transition: transform 0.3s ease-out, opacity 0.3s ease-out;" 
             data-current-apartment-id="">
            
            <div class="sticky top-0 bg-white p-4 border-b rounded-t-xl flex justify-between items-start z-10">
                <div>
                    <h2 id="modal-title" class="text-3xl font-bold text-slate-800">Nome Appartamento</h2>
                    <p id="modal-price" class="text-xl text-sky-600 font-semibold mt-1">€/notte*</p>
                </div>
                <button onclick="closeApartmentModal()" class="text-gray-500 hover:text-gray-800 transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div class="p-6 space-y-8">
                <div id="modal-image-gallery" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-xl font-semibold text-slate-700 mb-2" data-translate="modal_description_it_title">Descrizione (Italiano):</h3>
                        <p id="modal-description-it" class="text-gray-600 leading-relaxed"></p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-slate-700 mb-2" data-translate="modal_description_en_title">Description (English):</h3>
                        <p id="modal-description-en" class="text-gray-600 leading-relaxed"></p>
                    </div>
                </div>

                <div class="bg-gray-100 p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-slate-700 mb-2" data-translate="modal_accessories_title">Accessori:</h3>
                    <p id="modal-accessories" class="text-gray-700"></p>
                </div>
                
                <div class="bg-gray-100 p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-slate-700 mb-2" data-translate="modal_location_title">Posizione:</h3>
                    <p id="modal-coordinates" class="text-gray-700 mb-3 text-sm"></p>
                    
                    <a id="modal-map-link" href="#" target="_blank" class="inline-flex items-center text-sky-600 hover:text-sky-800 font-medium transition duration-300 hidden">
                        <svg class="map-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        <span data-translate="modal_view_map">Vedi su Google Maps</span>
                    </a>
                </div>


                <div class="text-center pt-4 border-t">
                    <p id="modal-availability-text" class="text-xl font-bold text-red-500 mb-4" data-translate="modal_availability_title">Disponibilità:</p>
                    
                    <button id="show-contact-btn" onclick="toggleContactInfo()" class="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg transition duration-300" data-translate="modal_show_contact">Mostra Contatti Proprietario</button>

                    <div id="contact-info-box" class="contact-info-box border border-gray-200 bg-gray-50 rounded-lg">
                        <p id="owner-name" class="text-xl font-bold mb-2 text-slate-700"></p> 
                        <p class="text-sm font-medium mb-2 text-slate-700" data-translate="contact_owner_info">Contatti (per prenotazioni):</p>
                        <p class="text-lg font-semibold text-gray-700 mb-2">
                            <span data-translate="contact_email_label">Email:</span> 
                            <a id="owner-email" href="" class="text-sky-600 hover:text-sky-800 font-medium" target="_blank"></a>
                        </p>
                         <p class="text-lg font-semibold text-gray-700">
                            <span data-translate="contact_phone_label">Telefono:</span> 
                            <a id="owner-phone" href="" class="text-sky-600 hover:text-sky-800 font-medium" target="_blank"></a>
                        </p>
                    </div>

                </div>

            </div>
        </div>
    </div>
    
    <div id="disclaimer-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-75 flex items-center justify-center hidden" onclick="if(event.target === this) closeDisclaimerModal()">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8 m-4">
            <h2 class="text-2xl font-bold text-slate-800 mb-4" data-translate="disclaimer_title">Disclaimer</h2>
            <p class="text-gray-600 mb-4" data-translate="disclaimer_short_1">Le informazioni su questo sito sono fornite a scopo generale. FlyStay Malpensa si impegna per l'accuratezza, ma non garantisce la completezza o l'idoneità. L'affidamento su tali informazioni è a vostro rischio.</p>
            <p class="text-gray-600 mb-4" data-translate="disclaimer_short_2">Non saremo responsabili per eventuali perdite o danni indiretti. Collegamenti esterni non sono sotto il nostro controllo e non implicano approvazione.</p>
            <p class="text-gray-600 mb-4" data-translate="disclaimer_short_3">Ci impegniamo a mantenere il sito operativo, ma non siamo responsabili per interruzioni temporanee dovute a problemi tecnici fuori dal nostro controllo.</p>
            <button onclick="closeDisclaimerModal()" class="mt-4 bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Chiudi</button>
        </div>
    </div>


    <script>
        // ***************************************************************
        // *** IL TUO LINK CSV PUBBLICATO È INSERITO QUI ***
        // ***************************************************************
        const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8HIxIC8hvMJFpWGVnU7o_tXvxcLT2b8odkOJIvz_YP3XNgIRPzf6Y7HZFkyZMkKeUMDPl1oSi3z83/pub?output=csv'; 

        let apartmentsData = []; 

        const apartmentsContainer = document.getElementById('apartments-container');
        const featuredApartmentsContainer = document.getElementById('featured-apartments-container');
        const loadingIndicator = document.getElementById('loading-indicator');
        const noApartmentsMessage = document.getElementById('no-apartments-message');
        const noFeaturedMessage = document.getElementById('no-featured-message');
        const apartmentModal = document.getElementById('apartment-modal');
        const disclaimerModal = document.getElementById('disclaimer-modal');

        const modalTitle = document.getElementById('modal-title');
        const modalPrice = document.getElementById('modal-price');
        const modalDescriptionIt = document.getElementById('modal-description-it');
        const modalDescriptionEn = document.getElementById('modal-description-en');
        const modalAccessories = document.getElementById('modal-accessories');
        const modalAvailabilityText = document.getElementById('modal-availability-text');
        const modalImageGallery = document.getElementById('modal-image-gallery');
        const modalCoordinates = document.getElementById('modal-coordinates');
        const modalMapLink = document.getElementById('modal-map-link');
        
        // Nuovi elementi per i contatti
        const contactInfoBox = document.getElementById('contact-info-box');
        const ownerNameElement = document.getElementById('owner-name'); 
        const ownerEmailLink = document.getElementById('owner-email');
        const ownerPhoneLink = document.getElementById('owner-phone');
        const showContactBtn = document.getElementById('show-contact-btn');


        // Language settings
        let currentLang = 'it'; // Default language

        const translations = {
            it: {
                nav_apartments: 'Appartamenti',
                nav_about: 'Chi Siamo',
                nav_contact: 'Contatti',
                explore_button: 'Esplora Appartamenti',
                featured_title: '✨ Soluzioni in Evidenza ✨',
                featured_subtitle: 'Gli appartamenti PREMIUM sono consigliati da FlyStay Malpensa.',
                no_featured_found: 'Nessun appartamento in evidenza al momento.',
                apartments_available: 'Tutte le Soluzioni Disponibili',
                premium_badge_text: 'In Evidenza',
                loading_apartments: 'Caricamento appartamenti...',
                no_apartments_found: 'Nessun altro appartamento trovato.',
                contact_for_availability_card: 'Contattaci per conoscere la disponibilità.',
                contact_for_availability_modal: 'Contattaci per conoscere la disponibilità.',
                view_details_button: 'Vedi Dettagli',
                not_specified: 'Non specificato',
                hero_title: 'FlyStay Malpensa',
                hero_subtitle: 'Il tuo soggiorno perfetto vicino all\'aeroporto di Malpensa.',
                about_title: 'Chi Siamo',
                about_paragraph_1: 'Benvenuti su FlyStay Malpensa, la vostra soluzione ideale per un soggiorno confortevole e conveniente vicino all\'aeroporto di Malpensa. Comprendiamo l\'importanza di un riposo sereno prima o dopo un lungo viaggio, ed è per questo che ci impegniamo a offrire appartamenti accoglienti e ben attrezzati, pensati per soddisfare ogni vostra esigenza.',
                about_paragraph_2: 'La nostra missione è semplice: garantire un\'esperienza senza stress, offrendo alloggi di qualità superiore con tutti i comfort moderni, in posizioni strategiche che permettono un facile accesso all\'aeroporto e alle principali attrazioni della zona.',
                about_paragraph_3: 'Siamo qui per rendere il vostro viaggio il più piacevole possibile. Scegliete FlyStay Malpensa per un soggiorno indimenticabile!',
                reviews_title: 'Dicono di Noi',
                review_user_1_name: 'Marco Rossi',
                review_text_1: 'Soggiorno fantastico! L\'appartamento era pulitissimo e molto confortevole. Perfetto per chi ha bisogno di un punto d\'appoggio vicino Malpensa.',
                review_user_2_name: 'Laura Bianchi',
                review_text_2: 'Ottima posizione e personale molto disponibile. Ho apprezzato la tranquillità e la comodità. Tornerò sicuramente!',
                review_user_3_name: 'John Doe',
                review_text_3: 'Impeccable apartment and seamless check-in process. Highly recommend for anyone needing accommodation near Malpensa Airport.',
                view_all_reviews: 'Leggi tutte le recensioni',
                contact_title: 'Contatti Generali',
                contact_text: 'Hai domande o hai bisogno di assistenza generale? Non esitare a contattarci!',
                contact_email: 'Email:',
                contact_phone: 'Telefono:',
                footer_rights: 'Tutti i diritti riservati.',
                footer_info: 'Per informazioni:',
                footer_disclaimer: 'Disclaimer',
                disclaimer_title: 'Disclaimer',
                disclaimer_short_1: 'Le informazioni su questo sito sono fornite a scopo generale. FlyStay Malpensa si impegna per l\'accuratezza, ma non garantisce la completezza o l\'idoneità. L\'affidamento su tali informazioni è a vostro rischio.',
                disclaimer_short_2: 'Non saremo responsabili per eventuali perdite o danni indiretti. Collegamenti esterni non sono sotto il nostro controllo e non implicano approvazione.',
                disclaimer_short_3: 'Ci impegniamo a mantenere il sito operativo, ma non siamo responsabili per interruzioni temporanee dovute a problemi tecnici fuori dal nostro controllo.',
                modal_description_it_title: 'Descrizione (Italiano):',
                modal_description_en_title: 'Description (English):',
                modal_accessories_title: 'Accessori:',
                modal_availability_title: 'Disponibilità:',
                modal_location_title: 'Posizione:',
                modal_view_map: 'Vedi su Google Maps',
                modal_show_contact: 'Mostra Contatti Proprietario', 
                contact_owner_info: 'Contatti (per prenotazioni):', 
                contact_email_label: 'Email:',
                contact_phone_label: 'Telefono:',
            },
            en: {
                nav_apartments: 'Apartments',
                nav_about: 'About Us',
                nav_contact: 'Contact',
                explore_button: 'Explore Apartments',
                featured_title: '✨ Featured Solutions ✨',
                featured_subtitle: 'PREMIUM Apartments are selected by FlyStay Malpensa for you.',
                no_featured_found: 'No featured apartments at the moment.',
                apartments_available: 'All Available Solutions',
                premium_badge_text: 'Featured',
                loading_apartments: 'Loading apartments...',
                no_apartments_found: 'No other apartments found.',
                contact_for_availability_card: 'Contact us for availability.',
                contact_for_availability_modal: 'Contact us for availability.',
                view_details_button: 'View Details',
                not_specified: 'Not specified',
                hero_title: 'FlyStay Malpensa',
                hero_subtitle: 'Your perfect stay near Malpensa Airport.',
                about_title: 'About Us',
                about_paragraph_1: 'Welcome to FlyStay Malpensa, your ideal solution for a comfortable and convenient stay near Malpensa Airport. We understand the importance of a peaceful rest before or after a long journey, which is why we are committed to offering cozy and well-equipped apartments, designed to meet your every need.',
                about_paragraph_2: 'Our mission is simple: to ensure a stress-free experience, offering superior quality accommodations with all modern comforts, in strategic locations that allow easy access to the airport and the main attractions of the area.',
                about_paragraph_3: 'We are here to make your trip as pleasant as possible. Choose FlyStay Malpensa for an unforgettable stay!',
                reviews_title: 'What Our Guests Say',
                review_user_1_name: 'Mark White',
                review_text_1: 'Fantastic stay! The apartment was spotless and very comfortable. Perfect for anyone needing a base near Malpensa.',
                review_user_2_name: 'Laura Smith',
                review_text_2: 'Great location and very helpful staff. I appreciated the quietness and convenience. I will definitely be back!',
                review_user_3_name: 'John Doe',
                review_text_3: 'Impeccable apartment and seamless check-in process. Highly recommend for anyone needing accommodation near Malpensa Airport.',
                view_all_reviews: 'Read all reviews',
                contact_title: 'General Contact',
                contact_text: 'Do you have questions or need general assistance? Do not hesitate to contact us!',
                contact_email: 'Email:',
                contact_phone: 'Phone:',
                footer_rights: 'All rights reserved.',
                footer_info: 'For information:',
                footer_disclaimer: 'Disclaimer',
                disclaimer_title: 'Disclaimer',
                disclaimer_short_1: 'The information on this website is for general purposes only. FlyStay Malpensa strives for accuracy but does not guarantee completeness or suitability. Reliance on such information is at your own risk.',
                disclaimer_short_2: 'We will not be liable for any indirect loss or damage. External links are beyond our control and do not imply endorsement.',
                disclaimer_short_3: 'Every effort is made to keep the website up and running smoothly. However, FlyStay Malpensa takes no responsibility for, and will not be liable for, the website being temporarily unavailable due to technical issues beyond our control.',
                modal_description_it_title: 'Description (Italian):',
                modal_description_en_title: 'Description (English):',
                modal_accessories_title: 'Accessories:',
                modal_availability_title: 'Availability:',
                modal_location_title: 'Location:',
                modal_view_map: 'View on Google Maps',
                modal_show_contact: 'Show Owner Contact', 
                contact_owner_info: 'Contact (for bookings):', 
                contact_email_label: 'Email:',
                contact_phone_label: 'Phone:',
            }
        };

        // --- LOGICA DI CARICAMENTO DATI DA GOOGLE SHEET (ROBUSTA) ---
        async function fetchApartmentsFromSheet() {
            if (!GOOGLE_SHEET_CSV_URL) {
                console.error("ERRORE: Link CSV non configurato.");
                loadingIndicator.textContent = "ERRORE: Link CSV non configurato. Controlla il codice sorgente.";
                loadingIndicator.classList.remove('hidden');
                return;
            }

            loadingIndicator.classList.remove('hidden');
            loadingIndicator.textContent = translations[currentLang].loading_apartments;
            apartmentsContainer.innerHTML = ''; 
            featuredApartmentsContainer.innerHTML = ''; 

            try {
                const response = await fetch(GOOGLE_SHEET_CSV_URL);
                if (!response.ok) {
                    throw new Error(`Errore HTTP! Stato: ${response.status}`);
                }
                const csvText = await response.text();
                
                // --- ALGORITMO DI PARSING CSV PIÙ ROBUSTO PER GESTIRE VIRGOLE E SPAZI ---
                const lines = csvText.trim().split('\n');
                if (lines.length <= 1) {
                    apartmentsData = [];
                    console.warn("Nessun dato trovato nel foglio.");
                } else {
                    // Headers sono la prima riga e vengono puliti
                    const headers = lines[0].split(',').map(header => header.trim().replace(/"/g, ''));
                    
                    apartmentsData = lines.slice(1).map(line => {
                        let apartment = {};
                        let inQuotes = false;
                        let currentField = '';
                        let values = [];

                        // Itera carattere per carattere per gestire correttamente le virgole dentro le virgolette
                        for (let i = 0; i < line.length; i++) {
                            const char = line[i];

                            if (char === '"') {
                                // Se è una doppia virgoletta all'interno di un campo quotato (per scappare una virgoletta)
                                if (inQuotes && line[i+1] === '"') {
                                    currentField += char;
                                    i++; // Salta il prossimo carattere (la seconda virgoletta)
                                    continue;
                                }
                                // Toggle (accendi/spegni) lo stato delle virgolette
                                inQuotes = !inQuotes;
                                // Non includere le virgolette di apertura/chiusura nel contenuto del campo
                                continue; 
                            }

                            if (char === ',' && !inQuotes) {
                                // Trovata una virgola fuori dalle virgolette: il campo è completo
                                values.push(currentField.trim());
                                currentField = '';
                            } else {
                                // Aggiungi il carattere al campo corrente
                                currentField += char;
                            }
                        }
                        // Aggiungi l'ultimo campo dopo la fine della riga
                        values.push(currentField.trim());

                        // Mappa i valori agli header
                        headers.forEach((header, i) => {
                            // Assegna il valore, usando una stringa vuota se non c'è
                            apartment[header] = values[i] !== undefined ? values[i] : ''; 
                        });

                        // **LOGICA PREMIUM (Conversione robusta TRUE/FALSE)**
                        apartment.PREMIUM = (apartment.PREMIUM && apartment.PREMIUM.toLowerCase() === 'true');
                        
                        return apartment;
                    });
                }
                // --- FINE ALGORITMO DI PARSING CSV PIÙ ROBUSTO ---

                renderFeaturedApartments();
                renderApartmentCards();

            } catch (error) {
                console.error("Errore durante il recupero dei dati da Google Sheets:", error);
                noApartmentsMessage.textContent = "Impossibile caricare i dati degli appartamenti. Si prega di riprovare più tardi.";
                noApartmentsMessage.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        function setLanguage(lang) {
            currentLang = lang;
            applyTranslations();
            renderFeaturedApartments(); 
            renderApartmentCards(); 
            
            // Update active language button styles
            document.querySelectorAll('.lang-button').forEach(button => {
                if (button.id === `lang-${lang}`) {
                    button.classList.remove('bg-gray-600');
                    button.classList.add('bg-sky-500');
                } else {
                    button.classList.remove('bg-sky-500');
                    button.classList.add('bg-gray-600');
                }
            });

            // If modal is open, update its content
            if (!apartmentModal.classList.contains('hidden')) {
                const currentApartmentId = apartmentModal.dataset.currentApartmentId;
                const apartment = apartmentsData.find(apt => apt.ID === currentApartmentId);
                if (apartment) {
                    showApartmentDetails(apartment, false); // Pass false to avoid showing the modal again
                }
            }
        }

        function applyTranslations() {
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLang] && translations[currentLang][key]) {
                    element.textContent = translations[currentLang][key];
                }
            });
            // Update button text and labels explicitly
            showContactBtn.textContent = translations[currentLang].modal_show_contact;
            document.querySelector('#contact-info-box [data-translate="contact_owner_info"]').textContent = translations[currentLang].contact_owner_info;
            // Questi selettori sono aggiornati in showApartmentDetails, ma forziamo qui in caso di modale aperto
            if (!apartmentModal.classList.contains('hidden')) {
                document.querySelector('#owner-email').previousElementSibling.textContent = translations[currentLang].contact_email_label;
                document.querySelector('#owner-phone').previousElementSibling.textContent = translations[currentLang].contact_phone_label;
            }
        }

        // Funzione per generare il badge Medaglia/In Evidenza
        function getPremiumBadgeHTML() {
            return `
                <div class="premium-badge">
                    <svg class="medal-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 15.39L10 14.98l-3.41 2.41 1-4.09-3.17-2.77 4.14-.35L12 6l1.44 4.19 4.14.35-3.17 2.77 1 4.09z"/>
                    </svg>
                    ${translations[currentLang].premium_badge_text}
                </div>
            `;
        }

        // Funzioni per renderizzare gli appartamenti
        function renderFeaturedApartments() {
            featuredApartmentsContainer.innerHTML = '';
            // Filtra solo gli appartamenti con PREMIUM === true (booleano)
            const featuredApartments = apartmentsData.filter(apt => apt.PREMIUM);

            if (featuredApartments.length === 0) {
                noFeaturedMessage.classList.remove('hidden');
            } else {
                noFeaturedMessage.classList.add('hidden');
                featuredApartments.forEach(apartment => {
                    featuredApartmentsContainer.appendChild(createApartmentCard(apartment, true));
                });
            }
        }

        function renderApartmentCards() {
            apartmentsContainer.innerHTML = '';
            // Filtra solo gli appartamenti con PREMIUM === false (booleano)
            const standardApartments = apartmentsData.filter(apt => !apt.PREMIUM);
            
            if (apartmentsData.length === 0) {
                 return;
            }

            if (standardApartments.length === 0 && apartmentsData.some(apt => !apt.PREMIUM)) {
                // Messaggio mostrato solo se ci sono dati ma nessuno è NON-premium (situazione teoricamente rara)
                noApartmentsMessage.classList.add('hidden');
            } else if (standardApartments.length === 0) {
                 noApartmentsMessage.textContent = translations[currentLang].no_apartments_found;
                 noApartmentsMessage.classList.remove('hidden');
            } else {
                noApartmentsMessage.classList.add('hidden');
            }

            standardApartments.forEach(apartment => {
                apartmentsContainer.appendChild(createApartmentCard(apartment, false));
            });
        }

        function createApartmentCard(apartment, isPremium) {
            const apartmentCard = document.createElement('div');
            apartmentCard.className = 'bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden cursor-pointer flex flex-col apartment-card';
            if(isPremium) {
                apartmentCard.classList.add('border-4', 'border-yellow-400', 'ring-4', 'ring-yellow-200'); 
            }
            apartmentCard.setAttribute('data-id', apartment.ID);

            const descriptionKey = 'DESCRIZIONE ' + currentLang.toUpperCase();
            // Utilizza l'intero campo descrittivo (grazie al parser robusto)
            const descriptionText = apartment[descriptionKey] || apartment['DESCRIZIONE ITA'] || translations[currentLang].not_specified;
            // Tronca solo il testo per l'anteprima
            const truncatedDescription = descriptionText.substring(0, 100) + (descriptionText.length > 100 ? '...' : '');

            // **IMMAGINE COPERTINA: PULIZIA ESTREMA DELL'URL**
            const cleanUrl = (apartment.IMMAGINE_COPERTINA || '').replace(/[\s\n\r\t]/g, '').trim();
            
            // Logica di fallback: usa il link pulito o una stringa vuota (per mostrare l'icona rotta)
            const imageUrl = cleanUrl.length > 0 ? cleanUrl : '';


            apartmentCard.innerHTML = `
                <div class="relative overflow-hidden h-64"> 
                    <img src="${imageUrl}"
                        alt="${apartment.TITOLO}"
                        class="w-full h-full object-cover">
                    ${isPremium ? getPremiumBadgeHTML() : ''}
                </div>
                <div class="p-6 flex flex-col flex-grow">
                    <h3 class="text-xl font-semibold mb-2 text-slate-700">${apartment.TITOLO}</h3>
                    <p class="text-gray-600 mb-4 flex-grow">${truncatedDescription}</p>
                    <div class="mb-4 text-sm">
                        <h4 class="font-semibold text-slate-700 mb-1" data-translate="modal_availability_title">${translations[currentLang].modal_availability_title}:</h4>
                        <p class="text-gray-600">${translations[currentLang].contact_for_availability_card}</p>
                    </div>
                    <button class="view-details-btn mt-auto bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300" data-id="${apartment.ID}">
                        ${translations[currentLang].view_details_button}
                    </button>
                </div>
            `;

            const btn = apartmentCard.querySelector('.view-details-btn');
            
            const showDetailsHandler = (e) => {
                if (e) e.stopPropagation(); 
                showApartmentDetails(apartment, true);
            };

            btn.addEventListener('click', showDetailsHandler);
            apartmentCard.addEventListener('click', showDetailsHandler);

            return apartmentCard;
        }

        function toggleContactInfo() {
            contactInfoBox.classList.toggle('active');
        }

        function showApartmentDetails(apartment, shouldShowModal = true) {
            // Logica per popolare il modale
            apartmentModal.dataset.currentApartmentId = apartment.ID;
            modalTitle.textContent = apartment.TITOLO;
            modalPrice.textContent = `€${apartment.PREZZO || '??'} / notte*`;
            
            // Le descrizioni e gli accessori ora funzionano correttamente grazie al parser robusto
            modalDescriptionIt.textContent = apartment['DESCRIZIONE ITA'] || translations.it.not_specified;
            modalDescriptionEn.textContent = apartment['DESCRIZIONE ENG'] || translations.en.not_specified;
            modalAccessories.textContent = apartment.ACCESSORI || translations[currentLang].not_specified;
            modalAvailabilityText.textContent = translations[currentLang].contact_for_availability_modal;
            
            // Nasconde la casella dei contatti ad ogni apertura
            contactInfoBox.classList.remove('active');
            
            // Popola i campi email, telefono e NOME HOST (leggendo i valori interi)
            const hostName = apartment['NOME HOST'] || translations[currentLang].not_specified;
            const email = apartment.EMAIL || translations[currentLang].not_specified;
            const phone = apartment.TELEFONO || translations[currentLang].not_specified;
            
            ownerNameElement.textContent = hostName === translations[currentLang].not_specified ? '' : hostName;
            ownerEmailLink.textContent = email;
            ownerEmailLink.href = email === translations[currentLang].not_specified ? '#' : `mailto:${email}`;
            ownerPhoneLink.textContent = phone;
            ownerPhoneLink.href = phone === translations[currentLang].not_specified ? '#' : `tel:${phone.replace(/\s/g, '')}`; 
            
            // Assicurati che le traduzioni nel modale siano aggiornate
            applyTranslations();


            // Gestione galleria immagini (PULIZIA AGGRESSIVA DEGLI URL)
            modalImageGallery.innerHTML = '';
            
            const rawImagesString = apartment['IMMAGINI CASA'] || '';
            // Splitta, trimma e rimuove caratteri \s (spazi, newline, tab) da tutti gli URL della galleria
            const images = rawImagesString.split(',').map(url => url.replace(/[\s\n\r\t]/g, '').trim()).filter(url => url.length > 0);
            
            // Pulisce l'URL di copertina con la stessa logica
            const coverUrl = (apartment.IMMAGINE_COPERTINA || '').replace(/[\s\n\r\t]/g, '').trim();

            // Aggiunge l'immagine di copertina se è valida e non è già nella lista
            if (coverUrl.length > 0 && !images.includes(coverUrl)) {
                 images.unshift(coverUrl);
            }
            
            images.forEach(url => {
                // *** MODIFICA: LA LOGICA DI FALLBACK È STATA RIMOSSA QUI ***
                if (url.length > 0) {
                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = apartment.TITOLO;
                    modalImageGallery.appendChild(img);
                }
            });


            // Gestione mappa
            modalCoordinates.textContent = `Lat: ${apartment.LATITUDINE || translations[currentLang].not_specified}, Lon: ${apartment.LONGITUDINE || translations[currentLang].not_specified}`;
            if (apartment.LATITUDINE && apartment.LONGITUDINE) {
                // Costruzione di un link di Google Maps generico (usa il punto come separatore decimale)
                const lat = apartment.LATITUDINE.replace(',', '.');
                const lon = apartment.LONGITUDINE.replace(',', '.');
                const mapUrl = `http://maps.google.com/maps?q=${lat},${lon}`;
                modalMapLink.href = mapUrl;
                modalMapLink.classList.remove('hidden');
            } else {
                modalMapLink.classList.add('hidden');
            }

            if (shouldShowModal) {
                apartmentModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; 
                
                setTimeout(() => {
                    apartmentModal.querySelector('.max-w-4xl').classList.remove('scale-95', 'opacity-0');
                    apartmentModal.querySelector('.max-w-4xl').classList.add('scale-100', 'opacity-100');
                }, 10);
            }
        }

        function closeApartmentModal() {
            apartmentModal.querySelector('.max-w-4xl').classList.remove('scale-100', 'opacity-100');
            apartmentModal.querySelector('.max-w-4xl').classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                apartmentModal.classList.add('hidden');
                document.body.style.overflow = ''; 
            }, 300); 
        }
        
        // Modale Disclaimer Functions
        function showDisclaimer(event) {
            event.preventDefault(); 
            disclaimerModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeDisclaimerModal() {
            disclaimerModal.classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        // Scroll to Top Button Logic
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');

        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                scrollToTopBtn.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
                scrollToTopBtn.classList.add('opacity-100');
            } else {
                scrollToTopBtn.classList.remove('opacity-100');
                scrollToTopBtn.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
            }
        });

        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Initial load functions
        document.addEventListener('DOMContentLoaded', () => {
            // Setup language buttons
            document.getElementById('lang-it').addEventListener('click', () => setLanguage('it'));
            document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
            
            // Fetch data and render
            fetchApartmentsFromSheet(); 
            setLanguage(currentLang); 
        });
    </script>
</body>
</html>
